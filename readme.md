# Code Supplement for:  "A new climatology of continentality based on Lagrangian air mass travel times from the ocean"

This repository contains all code and data necessary to reproduce the analyses and figures presented in the paper.

The main dataset is `residence_time.nc`. The code is provided as a Python script and a series of Jupyter Notebooks, detailing the workflow from raw data processing to final figure generation.

## Files

* **`residence_time.nc`**: The primary, aggregated NetCDF dataset of gridded residence times. This file is the direct input for the figure-generating notebooks.
* **`calculate_travel_time.py`**: The main processing script for computing air-mass travel times from Lagrangian trajectory data. It reads monthly FLEXPART (LARA) trajectory output, applies a sea-ice mask, and calculates the cumulative time each trajectory spends over land versus ocean, binned to a regular latitude-longitude grid. This public version is functionally identical to the code used for the analysis in the publication but has been adapted for general use. The script accesses the publicly available data as described in Bakels et al., 2025. It is designed to be run in parallel on a high-performance computing (HPC) cluster since it is computationally intensive, as it processes raw data month by month.
* **`create_final_dataset.ipynb`**: A Jupyter Notebook that reads the individual monthly output files (generated by `calculate_travel_times.py`) and aggregates them to create the final, single `residence_time.nc` file.
* **`Fig_1_2.ipynb`**: A Jupyter Notebook that loads `residence_time.nc` to generate Figures 1 and 2 in the publication. For this, the data is temporally averaged firstly over the available time (01.01.1941 to 01.04.2024), secondly, the data is grouped by meteorological season (MAM, JJA, SON, DJF) and then subsequently averaged over the available time (01.01.1941 to 01.04.2024).
* **`Fig_3.ipynb`**: A Jupyter Notebook that loads `residence_time.nc` to generate Figure 3 in the publication. For this, data from 9 different domains is selected. For each month, the latitudinally weighted spatial average is calculated. To show temporal variability, the annual cycle for each domain is plotted using boxplots for each month.

## Requirements

The core Python dependencies required to run this code are:
* `numpy`
* `xarray`
* `scipy`
* `cfgrib` (for reading the sea ice GRIB file)
* `jupyter` (for running the notebooks)
* `matplotlib` / `cartopy`

## Workflow (How to Run)

1.  **Step 1:** Run `calculate_travel_times.py` on the raw LARA dataset. This is a long, parallel process that creates intermediate files for each month processed.
2.  **Step 2:** Run the `create_final_dataset.ipynb` notebook to aggregate all intermediate files into `residence_time.nc`. As an alternative to this and the previous step, download the dataset `residence_time.nc` directly.
3.  **Step 3:** Run `Fig_1_2.ipynb` and `Fig_3.ipynb` to reproduce the figures from the paper.

## Citation

When using this dataset or code, please cite the original publication

* **Paper:** 
Brack, G., DÃ¼tsch, M., & Stohl, A. (manuscript submitted). A new climatology of continentality based on Lagrangian air mass travel times from the ocean. Geophysical Research Letters.
* **This Dataset/Code:**: 